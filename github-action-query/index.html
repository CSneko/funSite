<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub ç”¨æˆ·æ´»åŠ¨æŸ¥è¯¢ (è¯¦ç»†æäº¤ç‰ˆ)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: #f6f8fa;
            color: #24292e;
            max-width: 750px;
            margin: 40px auto;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            border-radius: 8px;
            background: #fff;
        }
        h1 { text-align: center; font-size: 24px; color: #24292e; }
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        input[type="text"] {
            flex: 1; padding: 10px 14px; font-size: 16px;
            border: 1px solid #d1d5da; border-radius: 6px; outline: none;
        }
        input[type="text"]:focus {
            border-color: #0366d6; box-shadow: 0 0 0 3px rgba(3,102,214,0.3);
        }
        button {
            padding: 10px 20px; font-size: 16px; background-color: #2ea44f;
            color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;
        }
        button:hover { background-color: #2c974b; }
        .loading { text-align: center; color: #586069; display: none; padding: 20px 0; }
        .error {
            color: #cb2431; background-color: #ffeef0; padding: 12px;
            border-radius: 6px; display: none; margin-bottom: 20px;
        }
        .count-info { font-size: 14px; color: #586069; margin-bottom: 15px; text-align: right; display: none; }
        ul.timeline { list-style-type: none; padding: 0; margin: 0; }
        .timeline > li { padding: 16px 0; border-bottom: 1px solid #eaecef; }
        .timeline > li:last-child { border-bottom: none; }
        .event-header { font-size: 15px; margin-bottom: 8px; }
        .repo-name { font-weight: 600; color: #0366d6; text-decoration: none; }
        .repo-name:hover { text-decoration: underline; }
        .branch-badge {
            background-color: #e1e4e8; color: #24292e; padding: 2px 6px;
            border-radius: 4px; font-family: monospace; font-size: 12px; margin: 0 4px;
        }
        .event-detail {
            font-size: 14px; color: #24292e; background-color: #f6f8fa;
            padding: 10px 14px; border-radius: 6px; border: 1px solid #e1e4e8;
            margin-top: 6px; word-break: break-all;
        }
        /* é’ˆå¯¹ Commit åˆ—è¡¨çš„ç‰¹å®šæ ·å¼ */
        .commit-list { list-style-type: none; padding: 0; margin: 0; }
        .commit-list li {
            padding: 4px 0; font-size: 13px; line-height: 1.5; border-bottom: none; display: flex; gap: 8px;
        }
        .commit-sha { color: #0366d6; font-family: monospace; }
        .commit-sha:hover { text-decoration: underline; }
        .commit-msg { color: #444d56; flex: 1; }
        .time { font-size: 12px; color: #586069; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ğŸ” GitHub ç”¨æˆ·æ´»åŠ¨æŸ¥è¯¢</h1>
    
    <div class="search-box">
        <input type="text" id="usernameInput" placeholder="è¾“å…¥ GitHub ç”¨æˆ·å (å¦‚: torvalds)" onkeypress="handleKeyPress(event)">
        <button onclick="fetchActivities()">æŸ¥è¯¢</button>
    </div>

    <div id="loading" class="loading">æ­£åœ¨è·å–æ•°æ®ï¼Œè¯·ç¨å€™...</div>
    <div id="error" class="error"></div>
    <div id="countInfo" class="count-info"></div>
    <ul id="activityList" class="timeline"></ul>

    <!-- åº•éƒ¨å±…ä¸­å›¾ç‰‡ -->
<div id="bottom-image">
    <img src="https://c.cneko.org/c/@CrystalNeko?p=fun" alt="CrystalNeko">
</div>

<style>
#bottom-image {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 999;
}

#bottom-image img {
    width: 200px;
    height: 200px;
    object-fit: contain;
}
</style>

    <script>
        function handleKeyPress(event) {
            if (event.key === 'Enter') fetchActivities();
        }

        // HTMLå­—ç¬¦è½¬ä¹‰ï¼Œé˜²æ­¢æäº¤ä¿¡æ¯ä¸­å«æœ‰ < æˆ– > å¯¼è‡´é¡µé¢æ¸²æŸ“æ–­è£‚
        function escapeHTML(str) {
            return str.replace(/[&<>'"]/g, tag => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'
            }[tag] || tag));
        }

        async function fetchActivities() {
            const username = document.getElementById('usernameInput').value.trim();
            const activityList = document.getElementById('activityList');
            const loading = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const countInfo = document.getElementById('countInfo');

            if (!username) {
                showError("è¯·è¾“å…¥æœ‰æ•ˆçš„ GitHub ç”¨æˆ·åï¼");
                return;
            }

            activityList.innerHTML = '';
            errorDiv.style.display = 'none';
            countInfo.style.display = 'none';
            loading.style.display = 'block';

            try {
                const response = await fetch(`https://api.github.com/users/${username}/events/public?per_page=100`);
                
                if (!response.ok) {
                    if (response.status === 404) throw new Error("æ‰¾ä¸åˆ°è¯¥ç”¨æˆ·ï¼");
                    if (response.status === 403) throw new Error("è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè§¦å‘äº† GitHub API çš„é™åˆ¶ã€‚");
                    throw new Error("è·å–æ•°æ®æ—¶å‡ºé”™ï¼Œè¯·ç¨åå†è¯•ã€‚");
                }

                const events = await response.json();
                loading.style.display = 'none';

                if (events.length === 0) {
                    showError("è¯¥ç”¨æˆ·æœ€è¿‘æ²¡æœ‰ä»»ä½•å…¬å¼€æ´»åŠ¨ã€‚");
                    return;
                }

                countInfo.textContent = `å…±åŠ è½½äº†æœ€è¿‘çš„ ${events.length} æ¡æ´»åŠ¨è®°å½•`;
                countInfo.style.display = 'block';

                events.forEach(event => {
                    const li = document.createElement('li');
                    
                    const eventData = getEventDetails(event);
                    const repoUrl = `https://github.com/${event.repo.name}`;
                    const date = new Date(event.created_at).toLocaleString('zh-CN');

                    let detailHtml = eventData.detail 
                        ? `<div class="event-detail">${eventData.detail}</div>` 
                        : '';

                    li.innerHTML = `
                        <div class="event-header">
                            ${eventData.icon} <span>${eventData.action}</span> <a href="${repoUrl}" target="_blank" class="repo-name">${event.repo.name}</a>
                        </div>
                        ${detailHtml}
                        <div class="time">${date}</div>
                    `;
                    activityList.appendChild(li);
                });

            } catch (error) {
                loading.style.display = 'none';
                showError(error.message);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function getEventDetails(event) {
            let icon = "ğŸ“Œ";
            let action = "è¿›è¡Œäº†ä¸€æ¬¡æ“ä½œ";
            let detail = "";

            switch (event.type) {
                case 'PushEvent':
                    icon = "ğŸš€";
                    // æå–åˆ†æ”¯å
                    const branchName = event.payload.ref ? event.payload.ref.replace('refs/heads/', '') : 'æœªçŸ¥åˆ†æ”¯';
                    action = `æ¨é€åˆ°åˆ†æ”¯ <span class="branch-badge">${escapeHTML(branchName)}</span> äºé¡¹ç›®`;
                    
                    // æ·±åº¦æå–æ¯ä¸€ä¸ª Commit æäº¤ä»£ç è®°å½•
                    if (event.payload.commits && event.payload.commits.length > 0) {
                        let commitHtml = '<ul class="commit-list">';
                        
                        // éå†æœ€å¤šæ˜¾ç¤º 5 ä¸ªæäº¤è®°å½•é¿å…æ¡†å¤ªé•¿
                        const maxCommits = Math.min(event.payload.commits.length, 5);
                        for (let i = 0; i < maxCommits; i++) {
                            const commit = event.payload.commits[i];
                            // è·å–æäº¤ä¿¡æ¯çš„ç¬¬ä¸€è¡Œ
                            const safeMsg = escapeHTML(commit.message.split('\n')[0]);
                            const shortSha = commit.sha.substring(0, 7);
                            const commitUrl = `https://github.com/${event.repo.name}/commit/${commit.sha}`;
                            
                            commitHtml += `
                                <li>
                                    <a href="${commitUrl}" target="_blank" class="commit-sha">${shortSha}</a>
                                    <span class="commit-msg">${safeMsg}</span>
                                </li>`;
                        }
                        
                        if (event.payload.commits.length > 5) {
                            commitHtml += `<li><span class="commit-msg" style="color:#586069;">... ä»¥åŠå…¶ä»– ${event.payload.commits.length - 5} ä¸ªæäº¤</span></li>`;
                        }
                        commitHtml += '</ul>';
                        detail = commitHtml;
                    } else {
                        detail = `<div style="color: #586069; font-style: italic;">æœ¬æ¬¡ Push æ— éœ€è®°å½•çš„å…·ä½“ Commit ä¿¡æ¯</div>`;
                    }
                    break;

                case 'IssuesEvent':
                    icon = "ğŸ›";
                    action = `${event.payload.action === 'opened' ? 'å‘å¸ƒ' : (event.payload.action === 'closed' ? 'å…³é—­' : 'æ›´æ–°')}äº† Issue äº`;
                    if (event.payload.issue) detail = `<b>${escapeHTML(event.payload.issue.title)}</b>`;
                    break;

                case 'IssueCommentEvent':
                    icon = "ğŸ’¬";
                    action = `è¯„è®ºäº†é—®é¢˜ / PR äº`;
                    if (event.payload.issue) {
                        detail = `è¯é¢˜: <b>${escapeHTML(event.payload.issue.title)}</b>`;
                    }
                    break;

                case 'PullRequestEvent':
                    icon = "ğŸ”€";
                    action = `${event.payload.action === 'opened' ? 'æäº¤' : (event.payload.action === 'closed' ? 'å…³é—­/åˆå¹¶' : 'å¤„ç†')}äº† Pull Request äº`;
                    if (event.payload.pull_request) detail = `<b>${escapeHTML(event.payload.pull_request.title)}</b>`;
                    break;

                case 'CreateEvent':
                    icon = "ğŸ“¦";
                    const refType = event.payload.ref_type === 'repository' ? 'é¡¹ç›®' : `åˆ†æ”¯/æ ‡ç­¾`;
                    action = `åˆ›å»ºäº†æ–°å»º ${refType} äº`;
                    if (event.payload.ref) detail = `åç§°: <span class="branch-badge">${escapeHTML(event.payload.ref)}</span>`;
                    break;

                case 'WatchEvent':
                    icon = "â­ï¸";
                    action = "æ”¶è— (Starred) äº†é¡¹ç›®";
                    break;

                default:
                    action = `æ“ä½œ (${event.type}) äº`;
            }

            return { icon, action, detail };
        }
    </script>
</body>
</html>